function upload(){this.loadEnd=function(){bin=e.result;xhr=new XMLHttpRequest;ADD_PHP+="?up=true";rotate>0&&(ADD_PHP=ADD_PHP+"&rotate="+rotate);scale!=1&&(ADD_PHP=ADD_PHP+"&scale="+scale*100);xhr.open("POST",ADD_PHP,!0);var t="xxxxxxxxx",n="--"+t+"\r\n";n+="Content-Disposition: form-data; name='upload'; filename='"+file.name+"'\r\n";n+="Content-Type: application/octet-stream\r\n\r\n";n+=bin+"\r\n";n+="--"+t+"--";xhr.setRequestHeader("content-type","multipart/form-data; boundary="+t);if(xhr.sendAsBinary!=null)xhr.sendAsBinary(n);else{xhr.open("POST",ADD_PHP+"&base64=true",!0);xhr.setRequestHeader("UP-FILENAME",file.name);xhr.setRequestHeader("UP-SIZE",file.size);xhr.setRequestHeader("UP-TYPE",file.type);xhr.send(window.btoa(bin))}};this.loadError=function(e){switch(e.target.error.code){case e.target.error.NOT_FOUND_ERR:console.log("File not found!");break;case e.target.error.NOT_READABLE_ERR:console.log("File not readable!");break;case e.target.error.ABORT_ERR:console.log("Abort");break;default:console.log("Unknown read error")}};this.loadProgress=function(e){if(e.lengthComputable)var t=Math.round(e.loaded*100/e.total)};var e=new FileReader;e.addEventListener("loadend",this.loadEnd,!1);e.addEventListener("progress",this.loadProgress,!1);e.addEventListener("error",this.loadError,!1);e.readAsBinaryString(file)}function OnSliderChanged(e){e.id=="rotateNumber"?rotate=e.value:e.id=="scaleSlider"&&(scale=e.value*.01);var t=document.getElementById("addedIMG");t.style.webkitTransform="rotate("+rotate+"deg) scale("+scale+","+scale+")"}var ADD_PHP="../vPlotterAPI/add.php",CONFIG_PHP="../vPlotterAPI/config.php",rotate=0,scale=1,file;this.uploadPlace=document.getElementById("dropbox");this.uploadPlace.addEventListener("dragover",function(e){e.stopPropagation();e.preventDefault();document.getElementById("dropbox").className="over"},!0);this.uploadPlace.addEventListener("dragleave",function(e){e.stopPropagation();e.preventDefault();document.getElementById("dropbox").className="not-over"},!0);this.uploadPlace.addEventListener("drop",function(e){e.preventDefault();var t=e.dataTransfer;file=t.files[0];var n=new FileReader;n.addEventListener("loadend",function(e){bin=n.result;document.getElementById("dropbox").style.display="none";var t=document.getElementById("preview");t.style.display="block";var r=document.getElementById("buttons");r.style.display="block";var i=document.createElement("img");i.id="addedIMG";i.className="addedIMG";i.file=file;i.src=bin;t.appendChild(i);var s=document.getElementById("scaleSlider")},!1);n.readAsDataURL(file)},!1);